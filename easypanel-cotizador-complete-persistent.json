{
  "services": [
    {
      "type": "app",
      "data": {
        "projectName": "sitios",
        "serviceName": "cotizador-construccion_def",
        "source": {
          "type": "dockerfile",
          "dockerfile": "FROM python:3.11-slim\n\nWORKDIR /code\n\n# Instalar dependencias del sistema\nRUN apt-get update && \\\n    apt-get install -y curl wget nodejs npm && \\\n    apt-get clean && \\\n    rm -rf /var/lib/apt/lists/*\n\n# Crear estructura de directorios\nRUN mkdir -p /code/backend-python/app /code/backend-node /code/frontend /code/data /code/logs /code/cache\n\n# Crear archivo requirements.txt para Python\nRUN echo 'fastapi==0.104.1' > /code/backend-python/requirements.txt && \\\n    echo 'uvicorn[standard]==0.24.0' >> /code/backend-python/requirements.txt && \\\n    echo 'python-multipart==0.0.6' >> /code/backend-python/requirements.txt && \\\n    echo 'reportlab==4.2.2' >> /code/backend-python/requirements.txt && \\\n    echo 'python-dotenv==1.0.0' >> /code/backend-python/requirements.txt && \\\n    echo 'httpx==0.25.2' >> /code/backend-python/requirements.txt\n\n# Instalar dependencias de Python\nRUN pip install --no-cache-dir -r /code/backend-python/requirements.txt\n\n# Crear package.json para Node.js\nRUN echo '{\"name\": \"cotizador-backend-node\", \"version\": \"1.0.0\", \"main\": \"index.js\", \"scripts\": {\"start\": \"node index.js\", \"dev\": \"nodemon index.js\"}, \"dependencies\": {\"express\": \"^4.18.2\", \"cors\": \"^2.8.5\", \"nodemailer\": \"^6.9.7\", \"axios\": \"^1.6.0\"}}' > /code/backend-node/package.json\n\n# Instalar dependencias de Node.js\nRUN cd /code/backend-node && npm install\n\n# Crear archivo main.py del backend Python\nRUN echo 'from fastapi import FastAPI, HTTPException, Request' > /code/backend-python/app/main.py && \\\n    echo 'from fastapi.middleware.cors import CORSMiddleware' >> /code/backend-python/app/main.py && \\\n    echo 'from fastapi.responses import JSONResponse' >> /code/backend-python/app/main.py && \\\n    echo 'from fastapi.staticfiles import StaticFiles' >> /code/backend-python/app/main.py && \\\n    echo 'import uvicorn' >> /code/backend-python/app/main.py && \\\n    echo 'import logging' >> /code/backend-python/app/main.py && \\\n    echo 'import os' >> /code/backend-python/app/main.py && \\\n    echo 'from datetime import datetime' >> /code/backend-python/app/main.py && \\\n    echo '' >> /code/backend-python/app/main.py && \\\n    echo 'logging.basicConfig(level=logging.INFO)' >> /code/backend-python/app/main.py && \\\n    echo 'logger = logging.getLogger(__name__)' >> /code/backend-python/app/main.py && \\\n    echo '' >> /code/backend-python/app/main.py && \\\n    echo 'app = FastAPI(title=\"Cotizador de Construcci√≥n API - Sumpetrol\", version=\"1.0.0\")' >> /code/backend-python/app/main.py && \\\n    echo '' >> /code/backend-python/app/main.py && \\\n    echo 'app.add_middleware(CORSMiddleware, allow_origins=[\"*\"], allow_credentials=True, allow_methods=[\"*\"], allow_headers=[\"*\"])' >> /code/backend-python/app/main.py && \\\n    echo '' >> /code/backend-python/app/main.py && \\\n    echo 'app.mount(\"/\", StaticFiles(directory=\"/code/frontend\", html=True), name=\"static\")' >> /code/backend-python/app/main.py && \\\n    echo '' >> /code/backend-python/app/main.py && \\\n    echo '@app.get(\"/api/health\")' >> /code/backend-python/app/main.py && \\\n    echo 'async def health_check():' >> /code/backend-python/app/main.py && \\\n    echo '    return {\"message\": \"Cotizador de Construcci√≥n API - Sumpetrol\", \"version\": \"1.0.0\", \"status\": \"activo\"}' >> /code/backend-python/app/main.py && \\\n    echo '' >> /code/backend-python/app/main.py && \\\n    echo '@app.get(\"/api/materiales/precios\")' >> /code/backend-python/app/main.py && \\\n    echo 'async def get_materials_prices():' >> /code/backend-python/app/main.py && \\\n    echo '    materials = [{\"id\": 1, \"nombre\": \"Hierro Redondo 6mm\", \"precio\": 1200, \"unidad\": \"kg\", \"categoria\": \"estructura\"}]' >> /code/backend-python/app/main.py && \\\n    echo '    return {\"success\": True, \"data\": materials, \"total\": len(materials)}' >> /code/backend-python/app/main.py && \\\n    echo '' >> /code/backend-python/app/main.py && \\\n    echo 'if __name__ == \"__main__\":' >> /code/backend-python/app/main.py && \\\n    echo '    uvicorn.run(app, host=\"0.0.0.0\", port=8000)' >> /code/backend-python/app/main.py\n\n# Crear archivo __init__.py\nRUN echo '' > /code/backend-python/app/__init__.py\n\n# Crear frontend b√°sico\nRUN echo '<!DOCTYPE html>' > /code/frontend/index.html && \\\n    echo '<html><head><title>Cotizador de Construcci√≥n</title></head>' >> /code/frontend/index.html && \\\n    echo '<body><h1>Cotizador de Construcci√≥n - Sumpetrol Argentina</h1>' >> /code/frontend/index.html && \\\n    echo '<p>Steel Frame ‚Ä¢ Industrial ‚Ä¢ Contenedores</p>' >> /code/frontend/index.html && \\\n    echo '<p>API funcionando correctamente</p>' >> /code/frontend/index.html && \\\n    echo '<p><a href=\"/api/health\">Ver estado de la API</a></p>' >> /code/frontend/index.html && \\\n    echo '<p><a href=\"/api/materiales/precios\">Ver materiales</a></p>' >> /code/frontend/index.html && \\\n    echo '</body></html>' >> /code/frontend/index.html\n\n# Crear script de inicio que copie archivos desde vol√∫menes\nRUN echo '#!/bin/bash' > /code/start.sh && \\\n    echo 'echo \"üöÄ Iniciando Cotizador de Construcci√≥n - Sumpetrol Argentina\"' >> /code/start.sh && \\\n    echo 'echo \"üìÅ Copiando archivos desde vol√∫menes persistentes...\"' >> /code/start.sh && \\\n    echo 'if [ -d \"/code/data/backend-python\" ]; then cp -r /code/data/backend-python/* /code/backend-python/; fi' >> /code/start.sh && \\\n    echo 'if [ -d \"/code/data/backend-node\" ]; then cp -r /code/data/backend-node/* /code/backend-node/; fi' >> /code/start.sh && \\\n    echo 'if [ -d \"/code/data/frontend\" ]; then cp -r /code/data/frontend/* /code/frontend/; fi' >> /code/start.sh && \\\n    echo 'echo \"üêç Iniciando servidor Python en puerto 8000...\"' >> /code/start.sh && \\\n    echo 'cd /code/backend-python && python -m uvicorn app.main:app --host 0.0.0.0 --port 8000' >> /code/start.sh\n\n# Hacer ejecutable el script de inicio\nRUN chmod +x /code/start.sh\n\n# Exponer puertos\nEXPOSE 8000 3000\n\n# Comando de inicio\nCMD [\"/code/start.sh\"]"
        },
        "env": "PYTHONPATH=/code\nPYTHONUNBUFFERED=1\nNODE_ENV=production\nPORT=8000\nAPP_NAME=Cotizador de Construcci√≥n\nAPP_VERSION=1.0.0\nAPP_ENV=production\nDEBUG=false\nLOG_LEVEL=info\nDOMAIN=cotizadordeconstruccion.sumpetrol.com.ar\nBASE_URL=https://cotizadordeconstruccion.sumpetrol.com.ar\nAPI_URL=https://cotizadordeconstruccion.sumpetrol.com.ar/api",
        "deploy": {
          "replicas": 1,
          "zeroDowntime": true
        },
        "domains": [
          {
            "host": "cotizadordeconstruccion.sumpetrol.com.ar",
            "https": true,
            "port": 8000,
            "path": "/",
            "middlewares": [],
            "certificateResolver": "",
            "wildcard": false,
            "internalProtocol": "http"
          }
        ],
        "mounts": [
          {
            "type": "volume",
            "name": "cotizador-data",
            "mountPath": "/code/data"
          },
          {
            "type": "volume",
            "name": "cotizador-logs",
            "mountPath": "/code/logs"
          },
          {
            "type": "volume",
            "name": "cotizador-cache",
            "mountPath": "/code/cache"
          }
        ]
      }
    }
  ]
}
