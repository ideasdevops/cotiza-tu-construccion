<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal Debug - Cotizador</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; }
        .estimate-grid { display: grid; gap: 10px; margin: 20px 0; }
        .estimate-item { display: flex; justify-content: space-between; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        .estimate-label { font-weight: bold; }
        .estimate-value { color: #007bff; }
        pre { background: #f1f1f1; padding: 10px; overflow-x: auto; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Test Modal Debug - Cotizador de Construcci√≥n</h1>
    
    <div class="test-section">
        <h2>Test 1: Simulaci√≥n de Estimaci√≥n R√°pida</h2>
        <button onclick="testQuickEstimateModal()">Probar Modal de Estimaci√≥n R√°pida</button>
        <div id="quickResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Simulaci√≥n de Cotizaci√≥n Detallada</h2>
        <button onclick="testDetailedQuoteModal()">Probar Modal de Cotizaci√≥n Detallada</button>
        <div id="detailedResult" class="result"></div>
    </div>

    <!-- Modal de Estimaci√≥n R√°pida -->
    <div id="quickEstimateModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-bolt"></i> Estimaci√≥n R√°pida</h2>
                <button class="modal-close" onclick="closeModal('quickEstimateModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="quickEstimateContent">
                    <!-- Contenido se llena din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cotizaci√≥n Detallada -->
    <div id="detailedQuoteModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-building"></i> Cotizaci√≥n Completa</h2>
                <button class="modal-close" onclick="closeModal('detailedQuoteModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="detailedQuoteContent">
                    <!-- Contenido se llena din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simular datos de respuesta de la API
        const mockEstimationResponse = {
            "success": true,
            "estimation": {
                "area": "120.0 m¬≤",
                "construction_type": "Industrial",
                "usage_type": "Residencial",
                "finish_level": "B√°sico",
                "floors": 2,
                "location": "La Rioja",
                "estimated_cost": "U$D 84,240",
                "estimated_time": "1.5 meses",
                "base_price_per_m2": "U$D 600/m¬≤",
                "location_multiplier": "0.9x",
                "floor_multiplier": "1.3x"
            },
            "timestamp": "2025-10-08T13:27:41.358309"
        };

        const mockQuoteResponse = {
            "success": true,
            "quote": {
                "client_name": "Franco",
                "client_email": "frsponton@gmail.com",
                "client_phone": "+5492613151000",
                "construction_type": "Industrial",
                "usage_type": "Residencial",
                "finish_level": "B√°sico",
                "area": "120.0 m¬≤",
                "floors": 2,
                "location": "La Rioja",
                "total_cost": "U$D 114,240",
                "estimated_time": "1.5 meses",
                "breakdown": [
                    {"category": "Estructura B√°sica", "cost": "U$D 25,920", "percentage": "40%"},
                    {"category": "Materiales", "cost": "U$D 19,440", "percentage": "30%"},
                    {"category": "Mano de Obra", "cost": "U$D 12,960", "percentage": "20%"},
                    {"category": "Instalaciones", "cost": "U$D 6,480", "percentage": "10%"}
                ],
                "additional_costs": "U$D 30,000",
                "base_cost": "U$D 84,240",
                "quote_date": "08/10/2025",
                "valid_until": "07/11/2025"
            },
            "timestamp": "2025-10-08T13:27:49.537545"
        };

        function testQuickEstimateModal() {
            console.log('üß™ Probando modal de estimaci√≥n r√°pida...');
            
            try {
                // Simular la l√≥gica del frontend
                const response_data = mockEstimationResponse;
                console.log('üìä Datos recibidos:', response_data);
                
                const modal = document.getElementById('quickEstimateModal');
                const content = document.getElementById('quickEstimateContent');
                
                if (!modal || !content) {
                    console.error('‚ùå Modal o contenido no encontrado');
                    document.getElementById('quickResult').innerHTML = '‚ùå Error: Modal o contenido no encontrado';
                    return;
                }
                
                // Extraer estimation de la respuesta
                const estimation = response_data.estimation || response_data;
                console.log('üìã Estimation extra√≠do:', estimation);
                
                // Validar y extraer datos de manera segura
                const area = estimation?.area || 'N/A';
                const constructionType = estimation?.construction_type || 'N/A';
                const cost = estimation?.estimated_cost || 'N/A';
                const time = estimation?.estimated_time || 'N/A';
                const location = estimation?.location || 'N/A';
                const usageType = estimation?.usage_type || 'N/A';
                const finishLevel = estimation?.finish_level || 'N/A';
                
                console.log('üìä Datos extra√≠dos:', { area, constructionType, cost, time, location, usageType, finishLevel });
                
                // Verificar que los datos no sean N/A
                if (area === 'N/A' || constructionType === 'N/A' || cost === 'N/A' || time === 'N/A') {
                    console.error('‚ùå Datos extra√≠dos son N/A, revisando estructura de datos...');
                    console.log('üìã Estructura completa de estimation:', JSON.stringify(estimation, null, 2));
                }
                
                // Generar contenido din√°mico para el modal
                content.innerHTML = `
                    <div class="estimate-grid">
                        <div class="estimate-item">
                            <span class="estimate-label">√Årea del Proyecto:</span>
                            <span class="estimate-value">${area}</span>
                        </div>
                        <div class="estimate-item">
                            <span class="estimate-label">Tipo de Construcci√≥n:</span>
                            <span class="estimate-value">${constructionType}</span>
                        </div>
                        <div class="estimate-item">
                            <span class="estimate-label">Costo Estimado:</span>
                            <span class="estimate-value">${cost}</span>
                        </div>
                        <div class="estimate-item">
                            <span class="estimate-label">Tiempo Estimado:</span>
                            <span class="estimate-value">${time}</span>
                        </div>
                    </div>
                    <div class="estimate-note">
                        <p><i class="fas fa-info-circle"></i> Esta es una estimaci√≥n r√°pida basada en par√°metros est√°ndar. Para una cotizaci√≥n detallada con materiales espec√≠ficos, utiliza "Calcular Cotizaci√≥n Completa".</p>
                    </div>
                `;
                
                console.log('‚úÖ Contenido din√°mico generado para el modal');
                
                // Mostrar modal
                modal.style.display = 'flex';
                
                document.getElementById('quickResult').innerHTML = '‚úÖ Modal de estimaci√≥n r√°pida mostrado correctamente';
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                document.getElementById('quickResult').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        function testDetailedQuoteModal() {
            console.log('üß™ Probando modal de cotizaci√≥n detallada...');
            
            try {
                // Simular la l√≥gica del frontend
                const response_data = mockQuoteResponse;
                console.log('üìä Datos recibidos:', response_data);
                
                const modal = document.getElementById('detailedQuoteModal');
                const content = document.getElementById('detailedQuoteContent');
                
                if (!modal || !content) {
                    console.error('‚ùå Modal o contenido no encontrado');
                    document.getElementById('detailedResult').innerHTML = '‚ùå Error: Modal o contenido no encontrado';
                    return;
                }
                
                // Extraer quote de la respuesta
                const quote = response_data.quote || response_data;
                console.log('üìã Quote extra√≠do:', quote);
                
                // Validar y extraer datos de manera segura
                const clientName = quote?.client_name || 'N/A';
                const constructionType = quote?.construction_type || 'N/A';
                const area = quote?.area || 'N/A';
                const floors = quote?.floors || 'N/A';
                const totalCost = quote?.total_cost || 'N/A';
                const estimatedTime = quote?.estimated_time || 'N/A';
                const finishLevel = quote?.finish_level || 'N/A';
                const location = quote?.location || 'N/A';
                const usageType = quote?.usage_type || 'N/A';
                const breakdown = quote?.breakdown || [];
                
                console.log('üìä Datos extra√≠dos:', { clientName, constructionType, area, floors, totalCost, estimatedTime, finishLevel, location, usageType, breakdown });
                
                // Verificar que los datos no sean N/A
                if (clientName === 'N/A' || constructionType === 'N/A' || area === 'N/A' || totalCost === 'N/A') {
                    console.error('‚ùå Datos extra√≠dos son N/A, revisando estructura de datos...');
                    console.log('üìã Estructura completa de quote:', JSON.stringify(quote, null, 2));
                }
                
                content.innerHTML = `
                    <div class="detailed-quote-summary">
                        <div class="quote-section">
                            <h3><i class="fas fa-building"></i> Informaci√≥n del Proyecto</h3>
                            <div class="quote-grid">
                                <div class="quote-item">
                                    <span class="label">Cliente:</span>
                                    <span class="value">${clientName}</span>
                                </div>
                                <div class="quote-item">
                                    <span class="label">Tipo de Construcci√≥n:</span>
                                    <span class="value">${constructionType}</span>
                                </div>
                                <div class="quote-item">
                                    <span class="label">√Årea:</span>
                                    <span class="value">${area}</span>
                                </div>
                                <div class="quote-item">
                                    <span class="label">Pisos:</span>
                                    <span class="value">${floors}</span>
                                </div>
                                <div class="quote-item">
                                    <span class="label">Ubicaci√≥n:</span>
                                    <span class="value">${location}</span>
                                </div>
                                <div class="quote-item">
                                    <span class="label">Tipo de Uso:</span>
                                    <span class="value">${usageType}</span>
                                </div>
                                <div class="quote-item">
                                    <span class="label">Nivel de Terminaci√≥n:</span>
                                    <span class="value">${finishLevel}</span>
                                </div>
                                <div class="quote-item">
                                    <span class="label">Tiempo Estimado:</span>
                                    <span class="value">${estimatedTime}</span>
                                </div>
                            </div>
                        </div>

                        <div class="quote-section">
                            <h3><i class="fas fa-calculator"></i> Desglose de Costos</h3>
                            <div class="breakdown-list">
                                ${breakdown.map(item => `
                                    <div class="breakdown-item">
                                        <span class="breakdown-label">${item.category || 'Categor√≠a'}:</span>
                                        <span class="breakdown-value">${item.cost || 'N/A'}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="quote-total">
                                <span class="total-label">Total Estimado:</span>
                                <span class="total-value">${totalCost}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                console.log('‚úÖ Contenido din√°mico generado para el modal de cotizaci√≥n detallada');
                
                // Mostrar modal
                modal.style.display = 'flex';
                
                document.getElementById('detailedResult').innerHTML = '‚úÖ Modal de cotizaci√≥n detallada mostrado correctamente';
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                document.getElementById('detailedResult').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
